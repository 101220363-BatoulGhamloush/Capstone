<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
</head>
<body>

<div th:fragment="content">
    <style>
        /* إلغاء الفراغات الزائدة حول المحتوى ليصبح ملاصقاً للـ Sidebar */
        .main-content {
            padding: 0 !important; /* إلغاء الـ Padding من المحتوى الأساسي */
            background: #f8fafc;
        }

        .dashboard-container {
            max-width: 100% !important; /* جعل الحاوية تأخذ العرض الكامل */
            margin: 0 !important;
            padding: 25px; /* فراغ داخلي بسيط لراحة العين فقط */
        }

        .page-header {
            margin-top: 0;
            border-radius: 0 0 20px 20px; /* تدوير الحواف السفلية فقط للهيدر */
            margin-bottom: 30px;
        }

        /* تحسين شكل الـ Sidebar والـ Content */
        @media (min-width: 992px) {
            .main-content {
                margin-left: 220px; /* التأكد من أن المسافة مطابقة لعرض الـ Sidebar */
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <div class="dashboard-container animate__animated animate__fadeIn">

        <div class="page-header d-flex justify-content-between align-items-center">
            <div>
                <h1 class="page-title">Platform Insights</h1>
                <p class="page-subtitle">Real-time data visualization and ecosystem performance</p>
            </div>
            <div class="text-end">
                <span class="badge bg-light text-dark shadow-sm p-2 px-3 rounded-pill">
                    <i class="bi bi-clock-history me-1"></i> Last Update: <span th:text="${#temporals.format(#temporals.createNow(), 'HH:mm')}"></span>
                </span>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon"><i class="bi bi-currency-dollar"></i></div>
                <div class="stat-value" th:text="'$' + ${totalRevenue}">$0</div>
                <div class="stat-label">Total Revenue</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="bi bi-people"></i></div>
                <div class="stat-value" th:text="${activeUsers}">0</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="bi bi-rocket-takeoff"></i></div>
                <div class="stat-value" th:text="${pendingRequests}">0</div>
                <div class="stat-label">Pending Approval</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="bi bi-trophy"></i></div>
                <div class="stat-value" th:text="${successRate} + '%'">0%</div>
                <div class="stat-label">Success Rate</div>
            </div>
        </div>

        <div class="row g-4">
            <div class="col-lg-8">
                <div class="search-filter-card h-100">
                    <h5 class="fw-bold mb-4"><i class="bi bi-graph-up-arrow me-2"></i>Financial Growth (Monthly)</h5>
                    <div style="height: 350px;">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="search-filter-card h-100">
                    <h5 class="fw-bold mb-4"><i class="bi bi-pie-chart me-2"></i>Project Types</h5>
                    <canvas id="typeChart"></canvas>
                </div>
            </div>

            <div class="col-md-4">
                <div class="search-filter-card">
                    <h5 class="fw-bold mb-4"><i class="bi bi-person-plus me-2"></i>New Users</h5>
                    <canvas id="usersChart"></canvas>
                </div>
            </div>

            <div class="col-md-4">
                <div class="search-filter-card">
                    <h5 class="fw-bold mb-4"><i class="bi bi-layers me-2"></i>Project Submissions</h5>
                    <canvas id="projectsChart"></canvas>
                </div>
            </div>

            <div class="col-md-4">
                <div class="search-filter-card">
                    <h5 class="fw-bold mb-4"><i class="bi bi-check2-circle me-2"></i>System Status</h5>
                    <canvas id="statusChart"></canvas>
                </div>
            </div>

            <div class="col-md-6">
                <div class="search-filter-card">
                    <h5 class="fw-bold mb-4"><i class="bi bi-bullseye me-2"></i>Engagement Metrics</h5>
                    <canvas id="radarChart" style="max-height: 300px;"></canvas>
                </div>
            </div>

            <div class="col-md-6">
                <div class="search-filter-card">
                    <h5 class="fw-bold mb-4"><i class="bi bi-compass me-2"></i>Contribution Density</h5>
                    <canvas id="polarChart" style="max-height: 300px;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        // التأكد من أن الرسوم تبدأ بعد تحميل الصفحة بالكامل
        document.addEventListener("DOMContentLoaded", function() {
            const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

            // سحب البيانات من Thymeleaf
            const fundsData = /*[[${fundsByMonth}]]*/ [];
            const usersData = /*[[${usersByMonth}]]*/ [];
            const projectsData = /*[[${projectsByMonth}]]*/ [];
            const typeData = /*[[${typeData}]]*/ [];
            const statusData = /*[[${statusData}]]*/ [];

            // 1. Revenue Chart
            new Chart(document.getElementById('revenueChart'), {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Funds ($)',
                        data: fundsData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });

            // 2. Type Chart
            new Chart(document.getElementById('typeChart'), {
                type: 'pie',
                data: {
                    labels: ['Charity', 'Fund', 'Loan'],
                    datasets: [{
                        data: typeData,
                        backgroundColor: ['#f5576c', '#43e97b', '#667eea']
                    }]
                }
            });

            // 3. Users Growth
            new Chart(document.getElementById('usersChart'), {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'New Registrations',
                        data: usersData,
                        backgroundColor: '#a1c4fd'
                    }]
                }
            });

            // 4. Projects Activity
            new Chart(document.getElementById('projectsChart'), {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Projects',
                        data: projectsData,
                        borderColor: '#fa709a',
                        backgroundColor: 'rgba(250, 112, 154, 0.2)',
                        fill: true
                    }]
                }
            });

            // 5. Status Chart
            new Chart(document.getElementById('statusChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Pending', 'Approved', 'Completed', 'Rejected'],
                    datasets: [{
                        data: statusData,
                        backgroundColor: ['#ffecd2', '#43e97b', '#667eea', '#fa709a']
                    }]
                }
            });

            // 6. Radar Chart
            new Chart(document.getElementById('radarChart'), {
                type: 'radar',
                data: {
                    labels: ['Users', 'Funds', 'Projects', 'Likes', 'Comments'],
                    datasets: [{
                        label: 'Activity Pulse',
                        data: [65, 90, 81, 56, 40],
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118, 75, 162, 0.2)'
                    }]
                }
            });

            // 7. Polar Chart
            new Chart(document.getElementById('polarChart'), {
                type: 'polarArea',
                data: {
                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                    datasets: [{
                        data: [11, 16, 7, 14],
                        backgroundColor: ['#667eea', '#f5576c', '#43e97b', '#ffecd2']
                    }]
                }
            });
        });
    </script>
</div>
</body>
</html>